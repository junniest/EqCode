%
% Definition of BNF syntax rules. 
%

%
% Rules for ordinary SAC programs
%

\newcommand{\BnfPrg}{
\bHead{prg}
  \bOpt{interface} def1
\bEnd
}

\newcommand{\BnfDefOne}{
\bHead{def1}
  \bOpt{tfspec} def2
\bEnd
}

\newcommand{\BnfDefTwo}{
\bHead{def2}
  \bOpt{structdef} def2 \bOr
  def3
\bEnd
}

\newcommand{\BnfDefThree}{
\bHead{def3}
  \bAlt{typedef}{exttypedef \bOpt{pragmas}} def3 \bOr
  def4
\bEnd
}

\newcommand{\BnfDefFour}{
\bHead{def4}
  \bAlt{objdef}{extobjdef\bOpt{pragmas}} def4 \bOr
  def5
\bEnd
}

\newcommand{\BnfDefFive}{
\bHead{def5}
  \bAltThree{\bToken{external}}{\bToken{specialize}}{fundef} fundec \bOpt{pragmas} def5 \bOr
  main def5
\bEnd
}

%
% Rules for imports
%

\newcommand{\BnfInterface}{
\bHead{interface}
  \bAltFour{import}{use}{export}{provide} \bToken{id} \bSymb{:}
  \bAlt{\bToken{all} \bOpt{\bToken{except} \bSkip
  \bSymb{\{} \bAlt{\bToken{id}}{reservedid} \bOpt{\bSymb{,}
  \bAlt{\bToken{id}}{reservedid}} \bSymb{\}}}}{\bSkip \bToken{symbolset}} \bSymb{;} \bOpt{interface}
\bEnd
}

%
% Rules for structs
%

\newcommand{\BnfStructDef}{
\bHead{structdef}
  \bToken{struct} \bToken{id} \bSymb{\{} structdef2 \bSymb{;}
\bEnd
}

\newcommand{\BnfStructDefTwo}{
\bHead{structdef2}
  ntype \bToken{id} \bStar{\bSymb{,} \bToken{id}} \bSymb{;} structdef2 \bOr
  \bSymb{\}}
\bEnd
}

% 
% Rules for typedefs
%

\newcommand{\BnfTypeDef}{
\bHead{typedef}
  \bToken{typedef} ntype \bToken{id} \bSymb{;}
\bEnd
}

\newcommand{\BnfExtTypeDef}{
\bHead{exttypedef}
  \bToken{external} \bToken{typedef} \bToken{id} \bSymb{;}
\bEnd
}

%
% Rules for objdefs
%

\newcommand{\BnfObjDef}{
\bHead{objdef}
    \bToken{objdef} ntype \bToken{id} = expr\_ap \bSymb{;}
\bEnd
}

\newcommand{\BnfExtObjDef}{
\bHead{extobjdef}
  \bToken{external} \bToken{objdef} ntype \bToken{id} \bSymb{;}
\bEnd
}

%
% Rules for fundefs
%

\newcommand{\BnfFunDef}{
\bHead{fundef}
  \bToken{inline} fundef1 \bOr
  fundef1
\bEnd
}

\newcommand{\BnfFunDefOne}{
\bHead{fundef1}
  \bToken{thread} fundef2 \bOr
  fundef2
\bEnd
}

\newcommand{\BnfFunDefTwo}{
\bHead{fundef2}
  \bAlt{\bToken{void}}{ntype \bStar{\bSymb{,} ntype}} \bAlt{ \bSymb{(} \bAlt{\bToken{id}}{reservedid}
  \bSymb{)}}{ \bAlt{\bToken{id}}{reservedid} } \bSymb{(} fundef3
\bEnd
}

\newcommand{\BnfFunDefThree}{
\bHead{fundef3}
  \bOpt{\bAlt{arg \bOpt{\bSymb{,} arg}}} \bSymb{)} exprblock \bOr
\bEnd
}

\newcommand{\BnfVarArgs}{
\bHead{varargs}
  arg \bOpt{\bToken{,} \bAlt{varargs}{\bSymb{...}}}
\bEnd
}

\newcommand{\BnfArg}{
\bHead{arg}
  ntype \bOpt{\bSymb{\&}} \bToken{id}
\bEnd
}

\newcommand{\BnfMain}{
\bHead{main}
  \bToken{int} \bToken{main} \bSymb{(} \bToken{void} \bSymb{)} exprblock
\bEnd
}

%
% Rules for fundecs
%

\newcommand{\BnfFunDec}{
\bHead{fundec}
    \bAltThree{\bToken{void}}{varntypes}{\bSymb{...}}
    \bAlt{\bToken{id}}{reservedid} \bSkip \bSymb{(} fundec2
\bEnd
}

\newcommand{\BnfFunDecTwo}{
\bHead{fundec2}
  \bOpt{\bAltThree{varargs}{\bToken{void}}{\bSymb{...}}} \bSymb{)} \bSymb{;}
\bEnd
}

%
% Rules for pragmas
%

\newcommand{\BnfPragmaCacheSim}{
\bHead{pragmacachesim}
  \bOpt{\bToken{\#} \bToken{pragma} \bToken{cachesim}
  \bOpt{\bPlus{\bToken{str}}}}
\bEnd
}

\newcommand{\BnfPragmas}{
\bHead{pragmas}
  \bPlus{pragma}  \bOr
  \bSymb{\#} \bToken{pragma} \bToken{wlcomp} expr\_ap
\bEnd
}

\newcommand{\BnfPragma}{
\bHead{pragma}
  \bSymb{\#} \bToken{pragma}
  \bAltSix{\bToken{linkname}}{\bToken{cudalinkname}}{\bSkip \bToken{linkwith}}{\bToken{linkobj}}{\bToken{copyfun}}{\bToken{freefun}} \bPlus{\bToken{str}} \bOr
  \bSymb{\#} \bToken{pragma} \bAlt{\bToken{linksign}}{\bToken{refcounting}}
  \bSymb{[} nums \bSymb{]} \bOr
  \bSymb{\#} \bToken{pragma} \bToken{effect} qual\_ext\_id \bStar{\bSymb{,} qual\_ext\_id} \bOr
  \bSymb{\#} \bToken{pragma}
  \bAltThree{\bToken{recountdots}}{\bToken{mutcthreadfun}}{\bSkip \bToken{noinline}}
\bEnd
}

%
% Rules for expression blocks
%

\newcommand{\BnfExprBlock}{
\bHead{exprblock}
  \bSymb{\{} pragmacachesim exprblock2
\bEnd
}

\newcommand{\BnfExprBlockTwo}{
\bHead{exprblock2}
  ntype \bToken{id} \bStar{\bSymb{,} \bToken{id}} \bSymb{;} exprblock2 \bOr
  assignOPTret \bSymb{\}}
\bEnd
}

\newcommand{\BnfAssignOPTret}{
\bHead{assignOPTret}
  \bOpt{\bToken{return} \bOpt{\bSymb{(} \bOpt{exprs} \bSymb{)}} \bSymb{;} \bOr
  assign assignsOPTret}
\bEnd
}

\newcommand{\BnfAssign}{
\bHead{assign}
  let \bSymb{;} \bOr
  cond \bOr
  doloop \bSymb{;} \bOr
  whileloop \bOr
  forloop
\bEnd
}

\newcommand{\BnfLet}{
\bHead{let}
  id \bStar{\bSymb{,} id} \bSymb{=} expr \bOr
  \bToken{id} \bSymb{.} \bToken{id} \bSymb{=} expr \bOr
  \bToken{id} \bSymb{[} exprs \bSymb{]} \bSymb{=} expr \bOr
  expr\_ap \bOr
  expr\_with \bOr
  \bToken{id} \bSymb{++} \bOr
  \bSymb{++} \bToken{id} \bOr
  \bToken{id} \bSymb{--} \bOr
  \bSymb{--} \bToken{id} \bOr
  \bToken{id} \bSymb{+} expr \bOr
  \bToken{id} \bSymb{-} expr \bOr
  \bToken{id} \bSymb{*} expr \bOr
  \bToken{id} \bSymb{/} expr \bOr
  \bToken{id} \bSymb{\%} expr
\bEnd
}

\newcommand{\BnfCond}{
\bHead{cond}
  \bToken{if} \bSymb{(} expr \bSymb{)} assignblock \bOpt{\bToken{else}
  assignblock}
\bEnd
}

\newcommand{\BnfDoLoop}{
\bHead{doloop}
  \bToken{do} assignblock
  \bToken{while} \bSymb{(} expr \bSymb{)}
\bEnd
}

\newcommand{\BnfWhileLoop}{
\bHead{whileloop}
  \bToken{while} \bSymb{(} expr \bSymb{)} assignblock
\bEnd
}

\newcommand{\BnfForLoop}{
\bHead{forloop}
  \bToken{for} \bSymb{(} let \bStar{ \bSymb{,} let } \bSymb{;} expr \bSymb{;}
  let \bStar{ \bSymb{,} let } \bSymb{)} \bSkip assignblock
\bEnd
}

\newcommand{\BnfAssignBlock}{
\bHead{assignblock}
  \bSymb{;} \bOr
  \bSymb{\{} pragmacachesim \bStar{assign} \bSymb{\}} \bOr
  assign
\bEnd
}

%
% Rules for expressions
%

\newcommand{\BnfExpr}{
\bHead{expr}
  \bSymb{.} \bOr
  \bSymb{...} \bOr
  subexpr
\bEnd
}

\newcommand{\BnfExprs}{
\bHead{exprs}
  expr \bStar{ \bSymb{,} expr }
\bEnd
}

\newcommand{\BnfSubExpr}{
\bHead{subexpr}
  subexpr \bSymb{.} \bToken{id} \bOr
  nostrexpr
\bEnd
}

\newcommand{\BnfNoStrExpr}{
\bHead{nostrexpr}
  qual\_ext\_id \bOr
  \bToken{numbyte} \bOr
  \bToken{numshort} \bOr
  \bToken{numint} \bOr
  \bToken{numlong} \bOr
  \bToken{numlonglong} \bOr
  \bToken{numubyte} \bOr
  \bToken{numushort} \bOr
  \bToken{numuint}  \bOr
  \bToken{numulong} \bOr
  \bToken{numulonglong} \bOr
  \bToken{num} \bOr
  \bToken{float} \bOr
  \bToken{double} \bOr
  \bToken{char} \bOr
  \bPlus{\bToken{str}} \bOr
  \bToken{true} \bOr
  \bToken{else} \bOr
  expr \bAlt{\bSymb{\&\&}}{\bSymb{||}} expr \bOr
  expr \bSymb{?} expr \bSymb{:} expr \bOr
  \bSymb{(} expr \bSymb{)} \bOr
  expr qual\_ext\_id expr \bOr
  \bAltFour{\bSymb{+}}{\bSymb{-}}{\bSymb{\~}}{\bSymb{!}} expr \bOr
  \bAltFour{\bSymb{+}}{\bSymb{-}}{\bSymb{\~}}{\bSymb{!}} \bSymb{(} expr \bSymb{,}
  exprs \bSymb{)} \bOr
  expr \bSymb{[} \bOpt{exprs} \bSymb{]} \bOr
  expr\_ap \bOr
  \bOpt{\bToken{local}} \bToken{with} with \bOr
  expr\_ar \bOr
  \bSymb{(} \bSymb{:} ntype \bSymb{)} expr \bOr
  \bSymb{\{} \bToken{id} \bSymb{->} expr \bSymb{\}} \bOr
  \bSymb{\{} \bSymb{[} exprs \bSymb{]} \bSymb{->} expr \bSymb{\}}
\bEnd
}

\newcommand{\BnfExprWith}{
\bHead{expr\_with}
  \bToken{with} with \bOr
  \bToken{local} \bToken{with} with
\bEnd
}

\newcommand{\BnfWith}{
\bHead{with}
  \bSymb{(} generator \bSymb{)} \bOpt{\bSymb{[} \bPlus{assign} \bSymb{]}} withop \bOr
  \bSymb{(} \bToken{id} \bSymb{)} \bPlus{part} nwithop \bOr
  \bOpt{\bSymb{\{} \bOpt{\bToken{\#} \bToken{pragma} \bToken{wlcomp} expr\_ap}
  \bOpt{\bPlus{npart}} \bSymb{\}}} \bSkip \bSymb{:}
  \bAlt{\bSymb{(} nwithop \bOpt{\bToken{,} nwithop} \bSymb{)}}{nwithop} \bOr
  \bOpt{\bSymb{\{} \bOpt{\bToken{\#} \bToken{pragma} \bToken{wlcomp} expr\_ap}
  \bPlus{npart} \bSymb{\}}} \bSkip \bSymb{:} \bToken{void}
\bEnd
}


\newcommand{\BnfExprAp}{
\bHead{expr\_ap}
  qual\_ext\_id \bSymb{(} \bOpt{ exprs } \bSymb{)} \bOr
  prf \bSymb{(} \bOpt{ exprs} \bSymb{)} \bOr
  \bToken{spawn} \bOpt{ \bSymb{(} \bToken{str} \bSymb{)} } qual\_ext\_id \bSymb{(} \bOpt{ exprs } \bSymb{)} \bOr
  \bToken{rspawn} \bOpt{ \bSymb{(} \bToken{str} \bSymb{)}} qual\_ext\_id  \bSymb{(} \bOpt{ exprs } \bSymb{)}
\bEnd
}

\newcommand{\BnfExprAr}{
\bHead{expr\_ar}
  \bSymb{[} \bOpt{exprs} \bSymb{]} \bOr
  \bSymb{[} \bSymb{:} ntype \bSymb{]} \bOr
  \bSymb{<} exprs \bSymb{>}
\bEnd
}

\newcommand{\BnfPart}{
  \bHead{part}
    \bSymb{(} generator \bSymb{)} \bOpt{\{ \bStar{assign} \}} \bOpt{ \bSymb{:}
    exprs }
    \bSymb{;}
\bEnd
}

\newcommand{\BnfNPart}{
  \bHead{npart}
    part \bOr
    \bSymb{(} generator \bSymb{)} \bOpt{\{ \bStar{assign} \}} \bSymb{:} \bSkip \bSymb{(} expr \bSymb{,} exprs \bSymb{)} \bSymb{;}
 \bEnd
}

\newcommand{\BnfGenerator}{
\bHead{generator}
  expr \bAlt{\bSymb{<=}}{\bSymb{<}} \bAlt{\bToken{id}}{\bOpt{\bToken{id}
  \bSymb{=}} \bSkip \bSymb{[} \bToken{id} \bStar{\bSymb{,} \bToken{id}} \bSymb{]}}
   \bAlt{\bSymb{<=}}{\bSymb{<}} \bSkip expr \bOpt{\bToken{step} expr}
   \bOpt{\bToken{width} expr} \bOr
\bEnd
}

\newcommand{\BnfGenIdx}{
\bHead{genidx}
  \bOpt{\bToken{id} \bSymb{=}} \bSymb{[} \bToken{id} \bStar{\bSymb{,} \bToken{id}}  \bSymb{]} \bOr
  \bToken{id}
\bEnd
}

\newcommand{\BnfWithOp}{
\bHead{withop}
  \bToken{genarray} \bSymb{(} expr \bSymb{,} expr \bOpt{\bSymb{,} expr} \bSymb{)} \bOr
  \bToken{modarray} \bSymb{(} expr \bSymb{,} \bToken{id} \bSymb{,} expr
  \bSymb{]} \bOr
  \bToken{fold} \bSymb{(} qual\_ext\_id \bSymb{,} expr \bSymb{,} expr
  \bSymb{)} \bOr
  \bToken{foldfix} \bSymb{(} qual\_ext\_id \bSymb{,} expr \bSymb{,} expr
  \bSymb{,} expr \bSymb{)}
\bEnd
}

\newcommand{\BnfNWithOp}{
\bHead{nwithop}
  \bToken{genarray} \bSymb{(} expr \bOpt{\bSymb{,} expr} \bSymb{)} \bOr
  \bToken{modarray} \bSymb{(} expr \bSymb{)} \bOr
  \bToken{fold} \bSymb{(} qual\_ext\_id \bSymb{,} expr \bSymb{)} \bOr
  \bToken{foldfix} \bSymb{(} qual\_ext\_id \bSymb{,} expr \bSymb{,} expr
  \bSymb{)} \bOr
  \bToken{propagate} \bSymb{(} expr \bSymb{)}
\bEnd
}

\newcommand{\BnfPrf}{
\bHead{prf}
  \bToken{\_dim\_A\_} \bOr
  \bToken{\_shape\_A\_} \bOr
  \bToken{\_reshape\_VxA\_} \bOr
  \bToken{\_sel\_VxA\_} \bOr
  \bToken{\_modarray\_AxVxS\_} \bOr
  \bToken{\_sel\_VxIA\_} \bOr
  \bToken{\_hideValue\_SxA\_} \bOr
  \bToken{\_hideShape\_SxA\_} \bOr
  \bToken{\_hideDim\_SxA\_} \bOr
  \bToken{\_add\_SxS\_} \bOr
  \bToken{\_add\_SxV\_} \bOr
  \bToken{\_add\_VxS\_} \bOr
  \bToken{\_add\_VxV\_} \bOr
  \bToken{\_sub\_SxS\_} \bOr
  \bToken{\_sub\_SxV\_} \bOr
  \bToken{\_sub\_VxS\_} \bOr
  \bToken{\_sub\_VxV\_} \bOr
  \bToken{\_mul\_SxS\_} \bOr
  \bToken{\_mul\_SxV\_} \bOr
  \bToken{\_mul\_VxS\_} \bOr
  \bToken{\_mul\_VxV\_} \bOr
  \bToken{\_div\_SxS\_} \bOr
  \bToken{\_div\_SxV\_} \bOr
  \bToken{\_div\_VxS\_} \bOr
  \bToken{\_div\_VxV\_} \bOr
  \bToken{\_mod\_SxS\_} \bOr
  \bToken{\_mod\_SxV\_} \bOr
  \bToken{\_mod\_VxS\_} \bOr
  \bToken{\_mod\_VxV\_} \bOr
  \bToken{\_abs\_S\_} \bOr
  \bToken{\_abs\_V\_} \bOr
  \bToken{\_neg\_S\_} \bOr
  \bToken{\_neg\_V\_} \bOr
  \bToken{\_reciproc\_S\_} \bOr
  \bToken{\_reciproc\_V\_} \bOr
  \bToken{\_min\_SxS\_} \bOr
  \bToken{\_min\_SxV\_} \bOr
  \bToken{\_min\_VxS\_} \bOr
  \bToken{\_min\_VxV\_} \bOr
  \bToken{\_max\_SxS\_} \bOr
  \bToken{\_max\_SxV\_} \bOr
  \bToken{\_max\_VxS\_} \bOr
  \bToken{\_max\_VxV\_} \bOr
  \bToken{\_eq\_SxS\_} \bOr
  \bToken{\_eq\_SxV\_} \bOr
  \bToken{\_eq\_VxS\_} \bOr
  \bToken{\_eq\_VxV\_} \bOr
  \bToken{\_neq\_SxS\_} \bOr
  \bToken{\_neq\_SxV\_} \bOr
  \bToken{\_neq\_VxS\_} \bOr
  \bToken{\_neq\_VxV\_} \bOr
  \bToken{\_lt\_SxS\_} \bOr
  \bToken{\_lt\_SxV\_} \bOr
  \bToken{\_lt\_VxS\_} \bOr
  \bToken{\_lt\_VxV\_} \bOr
  \bToken{\_le\_SxS\_} \bOr
  \bToken{\_le\_SxV\_} \bOr
  \bToken{\_le\_VxS\_} \bOr
  \bToken{\_le\_VxV\_} \bOr
  \bToken{\_gt\_SxS\_} \bOr
  \bToken{\_gt\_SxV\_} \bOr
  \bToken{\_gt\_VxS\_} \bOr
  \bToken{\_gt\_VxV\_} \bOr
  \bToken{\_ge\_SxS\_} \bOr
  \bToken{\_ge\_SxV\_} \bOr
  \bToken{\_ge\_VxS\_} \bOr
  \bToken{\_ge\_VxV\_} \bOr
  \bToken{\_not\_S\_} \bOr
  \bToken{\_not\_V\_} \bOr
  \bToken{\_and\_SxS\_} \bOr
  \bToken{\_and\_SxV\_} \bOr
  \bToken{\_and\_VxS\_} \bOr
  \bToken{\_and\_VxV\_} \bOr
  \bToken{\_or\_SxS\_} \bOr
  \bToken{\_or\_SxV\_} \bOr
  \bToken{\_or\_VxS\_} \bOr
  \bToken{\_or\_VxV\_} \bOr
  \bToken{\_tob\_S\_} \bOr
  \bToken{\_tos\_S\_} \bOr
  \bToken{\_toi\_S\_} \bOr
  \bToken{\_tol\_S\_} \bOr
  \bToken{\_toll\_S\_} \bOr
  \bToken{\_toub\_S\_} \bOr
  \bToken{\_tous\_S\_} \bOr
  \bToken{\_toui\_S\_} \bOr
  \bToken{\_toul\_S\_} \bOr
  \bToken{\_toull\_S\_} \bOr
  \bToken{\_tof\_S\_} \bOr
  \bToken{\_tod\_S\_} \bOr
  \bToken{\_toc\_S\_} \bOr
  \bToken{\_tobool\_S\_} \bOr
  \bToken{\_cat\_VxV\_} \bOr
  \bToken{\_take\_SxV\_} \bOr
  \bToken{\_drop\_SxV\_} \bOr
  \bToken{\_mask\_VxVxV\_} \bOr
  \bToken{\_non\_neg\_val\_S\_} \bOr
  \bToken{\_non\_neg\_val\_V\_} \bOr
  \bToken{\_val\_le\_val\_SxS\_} \bOr
  \bToken{\_val\_le\_val\_VxV\_}
\bEnd
}

\newcommand{\BnfQualExtId}{
\bHead{qual\_ext\_id}
  \bOpt { \bToken{id} \bSymb{::} } \bAlt{\bToken{id}}{reservedid} 
\bEnd
}

\newcommand{\BnfReservedId}{
\bHead{reservedid}
  \bToken{genarray} \bOr
  \bToken{modarray} \bOr
  \bToken{all}      \bOr
  \bSymb{\&}        \bOr
  \bSymb{!}         \bOr
  \bSymb{++}        \bOr
  \bSymb{--}        \bOr
  \bSymb{+}         \bOr
  \bSymb{-}         \bOr
  \bSymb{*}         \bOr
  \bSymb{<=}        \bOr
  \bSymb{<}         \bOr
  \bSymb{>} 
\bEnd
}

%
% Rules for typefamily (tf)
%

\newcommand{\BnfTfSpec}{
\bHead{tfspec}
  \bPlus{tfdef} \bPlus{tfrel}
\bEnd
}

\newcommand{\BnfTfDef}{
\bHead{tfdef}
  \bToken{abstract-typedef} \bToken{id} \bOpt{tfarg} \bSymb{;} \bOr
  \bToken{user-typedef} \bToken{id} tfarg \bSymb{;} \bOr
  \bToken{builtin-typedef} \bAlt{simplentype}{\bToken{id} \bOpt{\bSymb{(||}
  tfarg \bSymb{||)}}} \bSymb{;}
\bEnd
}

\newcommand{\BnfTfArg}{
\bHead{tfarg}
  \bToken{id} \bOpt{\bSymb{::} \bToken{id}} \bOpt{\bSymb{,}
  tfarg}
\bEnd
}

\newcommand{\BnfTfRel}{
\bHead{tfrel}
  \bToken{typerel} simplentype \bSymb{<:} \bAlt{simplentype}{\bToken{id}}
  \bSymb{;} \bOr
  \bToken{typerel} \bToken{id} \bSymb{<:} \bToken{id} \bOpt{\bToken{iff}
  tfexprs} \bSymb{;}
\bEnd
}

\newcommand{\BnfTfExprs}{
\bHead{tfexprs}
  tfexprs \bAltSeven{\bSymb{.}
  \bAlt{\bSymb{<}}{\bSymb{<=}}}{\bSymb{.>}}{\bSymb{.>=}}{\bSymb{.*}}{\bSymb{./}}{\bSkip \bSymb{.+}}{\bSymb{.-}}
  \bOr
  \bSymb{(} tfexprs \bSymb{)} \bOr
  \bAlt{\bToken{id}}{\bToken{num}}
\bEnd
}

%
% Rules for ntype
%

\newcommand{\BnfVarNTypes}{
\bHead{varntypes}
  ntype \bOpt{\bSymb{,} \bAlt{ntype \bStar{\bSymb{,} ntype}}{\bSymb{...}}}
\bEnd
}

\newcommand{\BnfNType}{
  \bHead{ntype}
  basentype \bOr
  basentype \bSymb{[} \bOpt{exprs} \bSymb{]}
\bEnd
}

\newcommand{\BnfBaseNType}{
  \bHead{basentype}
  simpletype \bOr
  userntype \bOr
  polyntype
\bEnd
}

\newcommand{\BnfSimpleNType}{
  \bHead{simplentype}
  \bToken{byte} \bOr
  \bToken{short} \bOr
  \bToken{int} \bOr
  \bToken{long} \bOr
  \bToken{longlong} \bOr
  \bToken{ubyte} \bOr
  \bToken{ushort} \bOr
  \bToken{uint} \bOr
  \bToken{ulong} \bOr
  \bToken{ulonglong} \bOr
  \bToken{float} \bOr
  \bToken{bool} \bOr
  \bToken{char} \bOr
  \bToken{double}
\bEnd
}

\newcommand{\BnfUserNType}{
\bHead{userntype}
  \bAlt{\bOpt{\bToken{struct}}}{\bToken{id} \bSymb{::}} \bToken{id}
\bEnd
}

\newcommand{\BnfPolyNType}{
\bHead{polyntype}
  \bSymb{<} \bToken{id} \bOpt {\bSymb{=} \bToken{id} \bSymb{[} \bToken{id}
  \bSymb{]}} \bSymb{>} \bOr
  \bSymb{<} \bToken{id} \bAlt{\bSymb{->}}{\bSymb{<-}} \bToken{id} \bSymb{[}
  \bToken{id} \bSymb{]}
  \bSymb{>}
\bEnd
}

%
% Rules for module implementation
%

\newcommand{\BnfModule}{
\bHead{module}
  \bToken{module} \bToken{id} deprecated \bSymb{;} interface def1
\bEnd
}

\newcommand{\BnfClass}{
\bHead{class}
  \bToken{class} \bToken{id} \bOpt{\bToken{deprecated} \bToken{str}} \bSymb{;}
  classtype \bOpt{pragmas} \bSkip
  interface def1
\bEnd
}

\newcommand{\BnfClassType}{
\bHead{classtype}
  \bToken{classtype} ntype \bSymb{;} \bOr
  \bToken{extern} \bToken{classtype} \bSymb{;}
\bEnd
}

%
% Rules for sac2src files
%

\newcommand{\BnfTargets}{
\bHead{targets}
  \bStar{\bToken{target} \bToken{id} \bStar{\bSymb{::} \bToken{id}} \bToken{:}
  resources}
\bEnd
}

\newcommand{\BnfResources}{
  \bHead{resources}
  \bStar{\bToken{id} \bAlt{\bSymb{:}}{\bSymb{+=}} \bSymb{=}
  \bAlt{\bToken{num}}{\bStar{\bToken{str}}}}
\bEnd
}
